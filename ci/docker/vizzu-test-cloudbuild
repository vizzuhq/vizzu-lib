
ARG TAG
FROM vizzu/vizzu-devenv:$TAG

   
# RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - && \
#     grep -qxF "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" /etc/apt/sources.list.d/google.list || echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | tee -a /etc/apt/sources.list.d/google.list && \
#     apt-get update -y && \
#     apt-get install -y google-chrome-stable && \
#     CHROMEVER=$(google-chrome --product-version | grep -o "[^\.]*\.[^\.]*\.[^\.]*") && \
#     DRIVERVER=$(curl -s "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROMEVER") && \
#     wget -q --continue -P /chromedriver "http://chromedriver.storage.googleapis.com/$DRIVERVER/chromedriver_linux64.zip" && \
#     unzip /chromedriver/chromedriver* -d /chromedriver

RUN mkdir /chromedriver
RUN wget --no-verbose -O /chromedriver/google-chrome-stable.deb https://dl.google.com/linux/chrome/deb/pool/main/g/google-chrome-stable/google-chrome-stable_114.0.5735.133-1_amd64.deb
RUN apt-get update -y && apt-get install -y /chromedriver/google-chrome-stable.deb
RUN wget -q --continue -P /chromedriver "http://chromedriver.storage.googleapis.com/114.0.5735.90/chromedriver_linux64.zip"
RUN unzip /chromedriver/chromedriver* -d /chromedriver

ADD . /workspace/
WORKDIR /workspace/test/integration
RUN npm install
RUN node test.js --vizzu /example/lib/vizzu.min.js --images DISABLED --hashes DISABLED --nologs
